<mat-expansion-panel>
  <mat-expansion-panel-header>
    <mat-panel-title>
      <mat-icon>list</mat-icon>
      <span>Word List</span>
    </mat-panel-title>
    <mat-panel-description>
      <span *ngIf="!loading">
        Total: {{counts.total}} | 
        <span *ngIf="counts.good > 0" style="color: green;">✓ {{counts.good}}</span>
        <span *ngIf="counts.good > 0 && (counts.unreviewed > 0 || counts.banned > 0 || counts.rejected > 0)"> | </span>
        <span *ngIf="counts.unreviewed > 0" style="color: orange;">⚠ {{counts.unreviewed}}</span>
        <span *ngIf="counts.unreviewed > 0 && (counts.banned > 0 || counts.rejected > 0)"> | </span>
        <span *ngIf="counts.banned > 0" style="color: red;">✗ {{counts.banned}}</span>
        <span *ngIf="counts.banned > 0 && counts.rejected > 0"> | </span>
        <span *ngIf="counts.rejected > 0" style="color: #ff9800;">⚠ {{counts.rejected}}</span>
      </span>
      <span *ngIf="loading">Loading...</span>
      <button *ngIf="hasChanges && !loading" 
              mat-icon-button 
              (click)="onRefreshClick(); $event.stopPropagation()"
              matTooltip="Refresh word list with current changes"
              style="margin-left: 8px;">
        <mat-icon>refresh</mat-icon>
      </button>
    </mat-panel-description>
  </mat-expansion-panel-header>

  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="30"></mat-spinner>
    <p>Loading word validation...</p>
  </div>

  <div *ngIf="!loading && words.length === 0" class="no-words">
    <p>No words found in this song.</p>
  </div>

  <div *ngIf="!loading && words.length > 0">
    <!-- Filter buttons -->
    <div class="filter-buttons">
      <button mat-button [class.active]="filterStatus === 'all'" (click)="filterStatus = 'all'">
        All ({{counts.total}})
      </button>
      <button *ngIf="counts.good > 0" mat-button [class.active]="filterStatus === STATUS_GOOD" (click)="filterStatus = STATUS_GOOD">
        <mat-icon style="color: green;">check_circle</mat-icon>
        Good ({{counts.good}})
      </button>
      <button *ngIf="counts.unreviewed > 0" mat-button [class.active]="filterStatus === STATUS_UNREVIEWED" (click)="filterStatus = STATUS_UNREVIEWED">
        <mat-icon style="color: orange;">info</mat-icon>
        Unreviewed ({{counts.unreviewed}})
      </button>
      <button *ngIf="counts.banned > 0" mat-button [class.active]="filterStatus === STATUS_BANNED" (click)="filterStatus = STATUS_BANNED">
        <mat-icon style="color: red;">error</mat-icon>
        Banned ({{counts.banned}})
      </button>
      <button *ngIf="counts.rejected > 0" mat-button [class.active]="filterStatus === STATUS_REJECTED" (click)="filterStatus = STATUS_REJECTED">
        <mat-icon style="color: #ff9800;">warning</mat-icon>
        Rejected ({{counts.rejected}})
      </button>
    </div>

    <!-- Word list -->
    <div class="word-list-container">
      <mat-list>
        <mat-list-item *ngFor="let wordWithStatus of getFilteredWords()" class="word-item">
          <mat-icon [color]="getStatusColor(wordWithStatus.status)" class="status-icon">
            {{getStatusIcon(wordWithStatus.status)}}
          </mat-icon>
          <span class="word-text" [class.banned-word]="wordWithStatus.status === STATUS_BANNED"
                [class.rejected-word]="wordWithStatus.status === STATUS_REJECTED"
                [class.unreviewed-word]="wordWithStatus.status === STATUS_UNREVIEWED"
                [class.good-word]="wordWithStatus.status === STATUS_GOOD">
            {{wordWithStatus.word}}
          </span>
          <span *ngIf="wordWithStatus.countInSong != null && wordWithStatus.countInSong > 0" class="word-count" title="In this song">
            ×{{wordWithStatus.countInSong}}
          </span>
          <span *ngIf="wordWithStatus.countInAllSongs != null" 
                class="word-count-total" 
                [ngClass]="getCommonnessColorClass(wordWithStatus.countInAllSongs)"
                [title]="getCommonnessTooltip(wordWithStatus.countInAllSongs)">
            ({{getCommonnessCategory(wordWithStatus.countInAllSongs)}})
          </span>
          
          <!-- Suggestions for rejected words -->
          <div *ngIf="wordWithStatus.status === STATUS_REJECTED && wordWithStatus.suggestions && wordWithStatus.suggestions.length > 0" 
               class="suggestions">
            <span class="suggestion-label">Suggestions:</span>
            <mat-chip-list>
              <mat-chip *ngFor="let suggestion of wordWithStatus.suggestions">
                {{suggestion}}
              </mat-chip>
            </mat-chip-list>
          </div>

          <!-- Action buttons -->
          <div class="word-actions">
            <button *ngIf="wordWithStatus.status === STATUS_UNREVIEWED" 
                    mat-icon-button 
                    color="primary" 
                    (click)="onReviewWord(wordWithStatus.word)"
                    matTooltip="Review word">
              <mat-icon>rate_review</mat-icon>
            </button>
          </div>
        </mat-list-item>
      </mat-list>
    </div>
  </div>
</mat-expansion-panel>
