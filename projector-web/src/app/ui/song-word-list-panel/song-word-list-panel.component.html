<mat-expansion-panel>
  <mat-expansion-panel-header>
    <mat-panel-title>
      <mat-icon>list</mat-icon>
      <span>Word List</span>
    </mat-panel-title>
    <mat-panel-description>
      <span *ngIf="!loading">
        Total: {{counts.total}} | 
        <span *ngIf="counts.good > 0" style="color: green;">✓ {{counts.good}}</span>
        <span *ngIf="counts.good > 0 && (counts.unreviewed > 0 || counts.banned > 0 || counts.rejected > 0)"> | </span>
        <span *ngIf="counts.unreviewed > 0" style="color: orange;">⚠ {{counts.unreviewed}}</span>
        <span *ngIf="counts.unreviewed > 0 && (counts.banned > 0 || counts.rejected > 0)"> | </span>
        <span *ngIf="counts.banned > 0" style="color: red;">✗ {{counts.banned}}</span>
        <span *ngIf="counts.banned > 0 && counts.rejected > 0"> | </span>
        <span *ngIf="counts.rejected > 0" style="color: #ff9800;">⚠ {{counts.rejected}}</span>
      </span>
      <span *ngIf="loading">Loading...</span>
      <button *ngIf="hasChanges && !loading" 
              mat-icon-button 
              (click)="onRefreshClick(); $event.stopPropagation()"
              matTooltip="Refresh word list with current changes"
              style="margin-left: 8px;">
        <mat-icon>refresh</mat-icon>
      </button>
    </mat-panel-description>
  </mat-expansion-panel-header>

  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="30"></mat-spinner>
    <p>Loading word validation...</p>
  </div>

  <div *ngIf="!loading && words.length === 0" class="no-words">
    <p>No words found in this song.</p>
  </div>

  <div *ngIf="!loading && words.length > 0">
    <!-- Filter buttons -->
    <div class="filter-buttons">
      <button mat-button [class.active]="filterStatus === 'all'" (click)="filterStatus = 'all'">
        All ({{counts.total}})
      </button>
      <button *ngIf="counts.good > 0" mat-button [class.active]="filterStatus === ReviewedWordStatus.REVIEWED_GOOD" (click)="filterStatus = ReviewedWordStatus.REVIEWED_GOOD">
        <mat-icon class="filter-icon-good">check_circle</mat-icon>
        Good ({{counts.good}})
      </button>
      <button *ngIf="counts.unreviewed > 0" mat-button [class.active]="filterStatus === ReviewedWordStatus.UNREVIEWED" (click)="filterStatus = ReviewedWordStatus.UNREVIEWED">
        <mat-icon class="filter-icon-unreviewed">info</mat-icon>
        Unreviewed ({{counts.unreviewed}})
      </button>
      <button *ngIf="counts.banned > 0" mat-button [class.active]="filterStatus === ReviewedWordStatus.BANNED" (click)="filterStatus = ReviewedWordStatus.BANNED">
        <mat-icon class="filter-icon-banned">error</mat-icon>
        Banned ({{counts.banned}})
      </button>
      <button *ngIf="counts.rejected > 0" mat-button [class.active]="filterStatus === ReviewedWordStatus.REJECTED" (click)="filterStatus = ReviewedWordStatus.REJECTED">
        <mat-icon class="filter-icon-rejected">warning</mat-icon>
        Rejected ({{counts.rejected}})
      </button>
    </div>

    <!-- Word list -->
    <div class="word-list-container">
      <mat-list>
        <mat-list-item *ngFor="let wordWithStatus of getFilteredWords()" class="word-item">
          <mat-icon [ngClass]="getStatusColorClass(wordWithStatus.status)" 
                    class="status-icon"
                    [matTooltip]="getStatusTooltip(wordWithStatus.status)">
            {{getStatusIcon(wordWithStatus.status)}}
          </mat-icon>
          <div class="word-info">
            <span class="word-text" [class.banned-word]="wordWithStatus.status === ReviewedWordStatus.BANNED"
                  [class.rejected-word]="wordWithStatus.status === ReviewedWordStatus.REJECTED"
                  [class.unreviewed-word]="wordWithStatus.status === ReviewedWordStatus.UNREVIEWED"
                  [class.good-word]="isGoodStatus(wordWithStatus.status)">
              {{wordWithStatus.word}}
            </span>
            <span *ngIf="wordWithStatus.countInSong != null && wordWithStatus.countInSong > 0" class="word-count" title="In this song">
              ×{{wordWithStatus.countInSong}}
            </span>
            <span *ngIf="wordWithStatus.countInAllSongs != null" 
                  class="word-count-total" 
                  [title]="getCommonnessTooltip(wordWithStatus.countInAllSongs)">
              <span class="commonness-badge" [ngClass]="getCommonnessColorClass(wordWithStatus.countInAllSongs)"></span>
            </span>
          </div>
          
          <!-- Suggestions for rejected words -->
          <div *ngIf="wordWithStatus.status === ReviewedWordStatus.REJECTED && wordWithStatus.suggestions && wordWithStatus.suggestions.length > 0" 
               class="suggestions">
            <span class="suggestion-label">Suggestions:</span>
            <mat-chip-list>
              <mat-chip *ngFor="let suggestion of wordWithStatus.suggestions">
                {{suggestion}}
              </mat-chip>
            </mat-chip-list>
          </div>

          <!-- Action buttons (match words-spell-checker style) -->
          <div class="word-actions">
            <div class="action-buttons-container">
              <!-- Group 2: Positive actions (good, context-specific, accepted) -->
              <div class="button-group button-group-positive">
                <app-mark-as-good-button
                        [wordWithStatus]="wordWithStatus"
                        (goodClick)="markAsGood(wordWithStatus.word)">
                </app-mark-as-good-button>
                <app-mark-as-context-specific-button
                        [wordWithStatus]="wordWithStatus"
                        (contextSpecificClick)="markAsContextSpecific(wordWithStatus.word)">
                </app-mark-as-context-specific-button>
                <app-mark-as-accepted-button
                        [wordWithStatus]="wordWithStatus"
                        (acceptedClick)="markAsAccepted(wordWithStatus.word)">
                </app-mark-as-accepted-button>
              </div>
              <!-- Group 1: Negative actions (banned, rejected) - only if reviewer -->
              <div class="button-group button-group-negative" *ngIf="hasReviewerRole">
                <app-mark-as-banned-button
                        [wordWithStatus]="wordWithStatus"
                        (bannedClick)="markAsBanned(wordWithStatus.word)">
                </app-mark-as-banned-button>
                <app-mark-as-rejected-button
                        [wordWithStatus]="wordWithStatus"
                        (rejectedClick)="markAsRejected(wordWithStatus.word)">
                </app-mark-as-rejected-button>
              </div>
            </div>
          </div>
        </mat-list-item>
      </mat-list>
    </div>
  </div>
</mat-expansion-panel>
